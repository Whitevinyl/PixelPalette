// PixelPalette v0.1.0 https://github.com/Whitevinyl/PixelPalette
function PxLoaderImage(t,e,n){var r=this,o=null;this.img=new Image,this.tags=e,this.priority=n;var i=function(){"complete"===r.img.readyState&&(u(),o.onLoad(r))},a=function(){u(),o.onLoad(r)},s=function(){u(),o.onError(r)},u=function(){r.unbind("load",a),r.unbind("readystatechange",i),r.unbind("error",s)};this.start=function(e){o=e,r.bind("load",a),r.bind("readystatechange",i),r.bind("error",s),r.img.src=t},this.checkStatus=function(){r.img.complete&&(u(),o.onLoad(r))},this.onTimeout=function(){u(),r.img.complete?o.onLoad(r):o.onTimeout(r)},this.getName=function(){return t},this.bind=function(t,e){r.img.addEventListener?r.img.addEventListener(t,e,!1):r.img.attachEvent&&r.img.attachEvent("on"+t,e)},this.unbind=function(t,e){r.img.removeEventListener?r.img.removeEventListener(t,e,!1):r.img.detachEvent&&r.img.detachEvent("on"+t,e)}}!function(t){function e(t){t=t||{},this.settings=t,null==t.statusInterval&&(t.statusInterval=5e3),null==t.loggingDelay&&(t.loggingDelay=2e4),null==t.noProgressTimeout&&(t.noProgressTimeout=1/0);var e,r=[],o=[],i=Date.now(),a={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4},s=function(t){return null==t?[]:Array.isArray(t)?t:[t]};this.add=function(t){t.tags=new n(t.tags),null==t.priority&&(t.priority=1/0),r.push({resource:t,status:a.QUEUED})},this.addProgressListener=function(t,e){o.push({callback:t,tags:new n(e)})},this.addCompletionListener=function(t,e){o.push({tags:new n(e),callback:function(e){e.completedCount===e.totalCount&&t(e)}})};var u=function(t){t=s(t);var e=function(e){for(var n=e.resource,r=1/0,o=0;o<n.tags.length;o++)for(var i=0;i<Math.min(t.length,r)&&!(n.tags.all[o]===t[i]&&r>i&&(r=i,0===r))&&0!==r;i++);return r};return function(t,n){var r=e(t),o=e(n);return o>r?-1:r>o?1:t.priority<n.priority?-1:t.priority>n.priority?1:0}};this.start=function(t){e=Date.now();var n=u(t);r.sort(n);for(var o=0,i=r.length;i>o;o++){var s=r[o];s.status=a.WAITING,s.resource.start(this)}setTimeout(l,100)};var l=function(){for(var e=!1,n=Date.now()-i,o=n>=t.noProgressTimeout,s=n>=t.loggingDelay,u=0,c=r.length;c>u;u++){var f=r[u];f.status===a.WAITING&&(f.resource.checkStatus&&f.resource.checkStatus(),f.status===a.WAITING&&(o?f.resource.onTimeout():e=!0))}s&&e&&g(),e&&setTimeout(l,t.statusInterval)};this.isBusy=function(){for(var t=0,e=r.length;e>t;t++)if(r[t].status===a.QUEUED||r[t].status===a.WAITING)return!0;return!1};var c=function(t,e){var n,s,u,l,c,g=null;for(n=0,s=r.length;s>n;n++)if(r[n].resource===t){g=r[n];break}if(null!=g&&g.status===a.WAITING)for(g.status=e,i=Date.now(),u=t.tags.length,n=0,s=o.length;s>n;n++)l=o[n],c=0===l.tags.length?!0:t.tags.intersects(l.tags),c&&f(g,l)};this.onLoad=function(t){c(t,a.LOADED)},this.onError=function(t){c(t,a.ERROR)},this.onTimeout=function(t){c(t,a.TIMEOUT)};var f=function(t,e){var n,o,i,s,u=0,l=0;for(n=0,o=r.length;o>n;n++)i=r[n],s=!1,s=0===e.tags.length?!0:i.resource.tags.intersects(e.tags),s&&(l++,(i.status===a.LOADED||i.status===a.ERROR||i.status===a.TIMEOUT)&&u++);e.callback({resource:t.resource,loaded:t.status===a.LOADED,error:t.status===a.ERROR,timeout:t.status===a.TIMEOUT,completedCount:u,totalCount:l})},g=this.log=function(t){if(window.console){var n=Math.round((Date.now()-e)/1e3);window.console.log("PxLoader elapsed: "+n+" sec");for(var o=0,i=r.length;i>o;o++){var s=r[o];if(t||s.status===a.WAITING){var u="PxLoader: #"+o+" "+s.resource.getName();switch(s.status){case a.QUEUED:u+=" (Not Started)";break;case a.WAITING:u+=" (Waiting)";break;case a.LOADED:u+=" (Loaded)";break;case a.ERROR:u+=" (Error)";break;case a.TIMEOUT:u+=" (Timeout)"}s.resource.tags.length>0&&(u+=" Tags: ["+s.resource.tags.all.join(",")+"]"),window.console.log(u)}}}}}function n(t){if(this.all=[],this.first=null,this.length=0,this.lookup={},t){if(Array.isArray(t))this.all=t.slice(0);else if("object"==typeof t)for(var e in t)t.hasOwnProperty(e)&&this.all.push(e);else this.all.push(t);this.length=this.all.length,this.length>0&&(this.first=this.all[0]);for(var n=0;n<this.length;n++)this.lookup[this.all[n]]=!0}}n.prototype.intersects=function(t){if(0===this.length||0===t.length)return!1;if(1===this.length&&1===t.length)return this.first===t.first;if(t.length<this.length)return t.intersects(this);for(var e in this.lookup)if(t.lookup[e])return!0;return!1},"function"==typeof define&&define.amd&&define("PxLoader",[],function(){return e}),t.PxLoader=e}(this),Date.now||(Date.now=function(){return(new Date).getTime()}),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),PxLoader.prototype.addImage=function(t,e,n){var r=new PxLoaderImage(t,e,n);return this.add(r),r.img},"function"==typeof define&&define.amd&&define("PxLoaderImage",[],function(){return PxLoaderImage}),!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.PixelPalette=t()}}(function(){return function t(e,n,r){function o(a,s){if(!n[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+a+"'")}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return o(n?n:t)},l,l.exports,t,e,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e){var n=function(){function t(t,e){this.context=t,this.imgPath=e}return t.prototype.Load=function(t){var e=this,n=new PxLoader,r=n.addImage(this.imgPath);n.addCompletionListener(function(){var n=r.width;e.context.drawImage(r,0,0,n,1);for(var o=e.context.getImageData(0,0,n,1),i=o.data,a=[],s=0;4*n>s;s+=4)a[s/4]="rgba("+i[s]+", "+i[s+1]+", "+i[s+2]+", 1)";t(a)}),n.start()},t}();e.exports=n},{}]},{},[1])(1)});